//
//  ResourceGenerator.swift
//  Localiziation
//
//  Created by Dan Leonard on 3/6/18.
//  Copyright Â© 2018 MacMeDan. All rights reserved.
//

import Foundation

func generateResourceEnum() {
    print("Reading from  <- \n          \(projectDirectory.appendingPathComponents(sourceFilePath.components(separatedBy: "/")).absoluteString)")
    print("Generating to -> \n          \(projectDirectory.appendingPathComponents(sourceFilePath.components(separatedBy: "/")).absoluteString)")
    let newValues = NSDictionary(contentsOf: projectDirectory.appendingPathComponents(sourceFilePath.components(separatedBy: "/"))).flatMap{$0}!
    let staticFunctions = newValues.map {
        """

            static func \($0)(_ comment: String = "\(($1 as! String).exscapeNewLine)") -> String {
                return NSLocalizedString("\($0)", comment: comment)
            }

        """
        }.joined()

    let contents = """
    //
    //  r.swift
    //  InspectionTool
    //
    //  Created by Dan Leonard on 3/1/18.
    //
    //  This file is autogenerated by \((#file as NSString).lastPathComponent)
    //
    // `r` represents Resource a common practace used in other development enviroments.


    struct r {

    \(staticFunctions)

    }

    """

    writeData(contents, path: resourceFilePath.components(separatedBy: "/")) {
        print($0)
        print("Generated Resources ðŸš€ at path \(projectDirectory.appendingPathComponents(resourceFilePath.components(separatedBy: "/")).absoluteString)")
    }

}

func generateNewStringsFile() {
    var newData: String
    let componets = sourceFilePath.components(separatedBy: "/")
    let allValues = Array(Set(NSDictionary(contentsOf: projectDirectory.appendingPathComponents(componets))!.allValues as! [String]))
    newData = allValues.flatMap{ getEntry(value: $0) }.joined()

    writeData(newData, path: sourceFilePath.components(separatedBy: "/")) { _ in
        generateResourceEnum()
    }
    
}
